<h1 class="mt-4" id="ctr">Histórico de Movimentações</h1>

<mat-card class="mt-4">
  <mat-card-content>
    <div *ngIf="isLoading" class="loading">Carregando histórico...</div>

    <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

    <table
      *ngIf="!isLoading && histories.length > 0"
      mat-table
      [dataSource]="histories"
      class="mat-elevation-z1 full-width-table"
      aria-label="Tabela de histórico de estudantes"
    >
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Nome</th>
        <td mat-cell *matCellDef="let h">{{ h.name }}</td>
      </ng-container>

      <ng-container matColumnDef="balance">
        <th mat-header-cell *matHeaderCellDef>Saldo</th>
        <td mat-cell *matCellDef="let h">{{ h.balance }}</td>
      </ng-container>

      <ng-container matColumnDef="totalPurchase">
        <th mat-header-cell *matHeaderCellDef>Total de Compras</th>
        <td mat-cell *matCellDef="let h">{{ h.totalPurchase }}</td>
      </ng-container>

      <ng-container matColumnDef="totalPrints">
        <th mat-header-cell *matHeaderCellDef>Total de Impressões</th>
        <td mat-cell *matCellDef="let h">{{ h.totalPrints }}</td>
      </ng-container>

      <ng-container matColumnDef="purchaseDates">
        <th mat-header-cell *matHeaderCellDef>Datas de Compras</th>
        <td mat-cell *matCellDef="let h">
          <div *ngIf="h.purchaseDates?.length > 0; else noPurchase">
            <div *ngFor="let date of h.purchaseDates">
              {{ date | date : 'short' }}
            </div>
          </div>
          <ng-template #noPurchase>—</ng-template>
        </td>
      </ng-container>

      <ng-container matColumnDef="printDates">
        <th mat-header-cell *matHeaderCellDef>Datas de Impressões</th>
        <td mat-cell *matCellDef="let h">
          <div *ngIf="h.printDates?.length > 0; else noPrint">
            <div *ngFor="let date of h.printDates">
              {{ date | date : 'short' }}
            </div>
          </div>
          <ng-template #noPrint>—</ng-template>
        </td>
      </ng-container>

      <tr
        mat-header-row
        *matHeaderRowDef="[
          'name',
          'balance',
          'totalPurchase',
          'totalPrints',
          'purchaseDates',
          'printDates'
        ]"
      ></tr>
      <tr
        mat-row
        *matRowDef="
          let row;
          columns: [
            'name',
            'balance',
            'totalPurchase',
            'totalPrints',
            'purchaseDates',
            'printDates'
          ]
        "
      ></tr>
    </table>

    <div *ngIf="!isLoading && histories.length === 0" class="no-data">
      Nenhum histórico encontrado.
    </div>
  </mat-card-content>
</mat-card>
